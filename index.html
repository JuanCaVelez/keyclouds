<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@700&display=swap" rel="stylesheet">
    <title>KeyClouds</title>
</head>
<body>
    <header>
    <nav class="navbar">
        <div class="logo">
            <h1>KeyClouds</h1>
        </div>
        <ul class="nav-links">
            <li><a href="#inicio">Inicio</a></li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" onclick="return false">
                    Productos <i class="fa-solid fa-chevron-down"></i>
                </a>
                <ul class="dropdown-menu" id="navbarCategoryMenu">
                    <li><a href="#productos" onclick="selectCategory('all', 'Todas las categorías'); return false;">Todas las categorías</a></li>
                </ul>
            </li>
        </ul>
        <div class="admin-access">
            <a href="login.html" class="admin-link" title="Acceso administrador">
                <i class="fa-solid fa-user-shield"></i>
            </a>
        </div>
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Buscar..." aria-label="Buscar productos">
            <button type="button" onclick="searchProducts()" aria-label="Buscar">
                <i class="fa-solid fa-magnifying-glass"></i>
            </button>
        </div>
        <!-- Barra de búsqueda completa solo visible en móvil (fila 3 del grid) -->
        <div class="search-full">
            <input type="text" id="searchInputMobile" placeholder="Buscar productos..." aria-label="Buscar productos">
            <button type="button" onclick="searchProductsMobile()" aria-label="Buscar">
                <i class="fa-solid fa-magnifying-glass"></i>
            </button>
        </div>
    </nav>
    </header>

    <section id="productos">
        <h2 id="productosTitle">Nuestros productos</h2>
        <div id="productosGrid" class="products-grid"></div>
        <div id="noProducts" class="no-products" style="display: none;">
            <p id="noProductsText"></p>
        </div>
    </section>

    <footer>
        <div class="footer-content">      
            <div class="social-media">
                <a href="https://wa.me/+593980467248" aria-label="Whatsapp">
                    <i class="fa-brands fa-whatsapp"></i> Whatsapp
                </a>
                <a href="https://www.tiktok.com/@key.clouds_ec" aria-label="Tik Tok">
                    <i class="fa-brands fa-tiktok"></i> Tik Tok
                </a>
                <a href="https://www.instagram.com/keycloudsstore/" aria-label="Instagram">
                    <i class="fa-brands fa-instagram"></i> Instagram
                </a>
            </div>
            <p>&copy; 2025 KeyClouds. All rights reserved.</p>
        </div>
    </footer>

    <script type="module">
        import {
            getCategories,
            getProducts,
            filterByCategory,
            displayProducts,
            changeProductImage,
            buyProduct
        } from "./script/products.js";

        window.changeProductImage = changeProductImage;
        window.buyProduct = buyProduct;

        window.onload = async function() {
            await displayProducts();
            loadNavbarCategoryMenu();
        };

        function loadNavbarCategoryMenu() {
            const menu = document.getElementById('navbarCategoryMenu');
            if (!menu) return;
            const categories = getCategories();

            let html = `
                <li>
                    <a href="#productos" onclick="selectCategory('all', 'Todas las categorías'); return false;">
                        Todas las categorías
                    </a>
                </li>
            `;

            categories.forEach(category => {
                html += `
                    <li>
                        <a href="#productos" onclick="selectCategory('${category}', '${category}'); return false;">
                            ${category}
                        </a>
                    </li>
                `;
            });

            menu.innerHTML = html;
        }

        window.selectCategory = async function(category, displayName) {
            const title = document.getElementById('productosTitle');
            if (title) {
                title.textContent =
                    category === "all"
                        ? "Nuestros productos"
                        : `Categoría: ${displayName}`;
            }

            await filterByCategory(category);
            document.getElementById("productos").scrollIntoView({ behavior: 'smooth' });
        };

        window.searchProducts = async function() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            const products = await getProducts();

            if (!searchTerm) {
                displayProducts(products);
                return;
            }

            const filtered = products.filter(product =>
                product.name.toLowerCase().includes(searchTerm) ||
                (product.category && product.category.toLowerCase().includes(searchTerm))
            );

            displayProducts(filtered);
        };

        // Búsqueda desde la barra móvil
        window.searchProductsMobile = async function() {
            const searchTerm = document.getElementById('searchInputMobile').value.toLowerCase().trim();
            const products = await getProducts();

            if (!searchTerm) {
                displayProducts(products);
                return;
            }

            const filtered = products.filter(product =>
                product.name.toLowerCase().includes(searchTerm) ||
                (product.category && product.category.toLowerCase().includes(searchTerm))
            );

            displayProducts(filtered);
        };

        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') window.searchProducts();
        });

        document.getElementById('searchInputMobile').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') window.searchProductsMobile();
        });
    </script>
</body>
</html>